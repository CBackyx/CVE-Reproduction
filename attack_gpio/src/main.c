/*
 * Copyright (c) 2012-2014 Wind River Systems, Inc.
 *
 * SPDX-License-Identifier: Apache-2.0
 */

// #include <zephyr.h>
// #include <misc/printk.h>

// void main(void)
// {
// 	printk("Hello World! %s\n", CONFIG_BOARD);
// }

#include <zephyr.h>
#include <misc/printk.h>
#include <gpio.h>

static void print_control(const char *s) {
	uint32_t control;
	__asm__ volatile ("mrs %0, CONTROL" : "=r"(control));
	printk("%s - CONTROL: 0x%X\n", s, control);
}

static void escalate(void) {
	print_control("escalated");
	// while (1) {}
}

static void user(void *p1, void *p2, void *p3) {
	struct gpio_driver_api api;
	struct device port;
	print_control("user");
	api.enable_callback = (void*)escalate;
	port.driver_api = &api;
	gpio_enable_callback(&port, 0, 0);
}
void main(void) {
	print_control("kernel");
	k_thread_user_mode_enter(user, NULL, NULL, NULL);
}