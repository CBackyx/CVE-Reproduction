/*
 * Copyright (c) 2012-2014 Wind River Systems, Inc.
 *
 * SPDX-License-Identifier: Apache-2.0
 */

// #include <zephyr.h>
// #include <misc/printk.h>

// void main(void)
// {
// 	printk("Hello World! %s\n", CONFIG_BOARD);
// }

#include <zephyr.h>
#include <misc/printk.h>

static void print_control(const char *s) {
	uint32_t control;
	__asm__ volatile ("mrs %0, CONTROL" : "=r"(control));
	printk("%s - CONTROL: 0x%X\n", s, control);
}

static void user(void *p1, void *p2, void *p3) {
	print_control("user");
	__asm__ volatile (
		"mov r6, %0\n"
		"svc 3\n" :: "r"(-0x10000000) : "r6"
	);
}

void main(void) {
	print_control("kernel");
	k_thread_user_mode_enter(user, NULL, NULL, NULL);
}